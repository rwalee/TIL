# 만들면서 배우는 클린 아키텍처
- 2022/04 부서 학습조직 교재
- 톰 홈버그 지음
- 자바 코드로 구현하는 클린 웹 어플리케이션

## 1. 계층형 아키텍처의 문제

## 2. 의존성 역전

## 3. 코드 구성

## 4. 유즈케이스 구현

## 5. 웹 어댑터 구현
- 웹 어댑터는 웹 인터페이스를 제공한다.
- 웹 인터페이스 : 웹 브라우저를 통해 상호작용할 수 있는 UI 로 다른 시스템에서 우리 어플을 호출하는 방식으로 상호작용하는 HTTP API.
- **이번 목표 : 외부 세계와의 모든 커뮤니케이션은 어댑터를 통한다.**

### (1) 의존성 역전

포트 인터페이스를 생략하고, 직접 호출할 수 있지만
||||
|--|--|--|
| Adapter.in.web | | App.service |
| Controller | -> | Service |
||||

간접계층을 넣음으로써 앱코어가 외부 세계와 통신할 수 있는 곳에 대한 명세가 `포트`가 된다.  
`포트`가 하는 일 : 외부로부터 요청을 받아 앱코어를 호출하고 무슨 일을 할 지 알려준다. (의존성 역전)
- 장점 : 어떤 통신이 일어나는지 파악 및 레거시 관리 용이

||||||
|--|--|--|--|--|
| Adapter.in.web |  | App.port.in |  | App.service |
| Controller | -> | <Interface> Port | ◁- | Service |
| WebSocketController | -> | <interface> Port | ◁- | Service |
| Adapter.in.web |  | App.port.out |  | App.service |
| WebSocketController | -▷ | <interface> Port | <- | Service |
|||

### (2) 웹 어댑터의 책임

웹 어댑터가 하는 일,
1. HTTP 요청을 자바 객채로 매핑 (역직렬화)
2. 인증/권한 검사
3. 입력 유효성 검증
4. 입력을 유즈케이스의 입력 모델로 매핑
5. 유즈케이스 호출
6. 유즈케이스 출력을 HTTP로 매핑 
7. HTTP 응답을 반환 (직렬화)
8. 일련의 과정에 문제가 생기면 예외를 던지고 호출자에게 보여줄 메시지로 변환.

- **HTTP와 관련된 것들은 어댑터에서 모두 해결하도록 함**

### (3) 컨트롤러 나누기
- 한 개 이상의 클래스로 구성 가능.
- 같은 hierarchy 에 놓아주면 된다.
- 얼마나 잘게 쪼갤까?  
 : 많이. 가능한 좁고 다른 컨트롤러와 적게 공유하도록.

하나의 컨트롤러에서 모두 처리 시 단점  
1. 클래스 하나당 코드수는 적을 수록 좋다
2. 파악이 어려움
3. 테스트 코드 찾기 어려움
4. 데이터 구조의 재활용을 촉진함  
-> 특정 연산에서는 필요없는 필드도 모두 들어있으므로 헷갈림 유도

제안 방안
- 가급적 각 연산에 대해 별도 패키지/컨트롤러 추천
- 함수/클래스명도 유즈케이스를 최대한 반영하도록
- 동시작업 병합 충돌 방지

### (4) 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?
- 웹 어댑터는 어떤 도메인 로직도 수행하지 않는다.
- 앱은 어떤 HTTP 로직도 수행하지 않는다.
- 모델을 공유하지 않는 작은 클래스로 잘게 쪼갠다.
  - 파악 굿
  - 테스트 굿
  - 동시작업 굿
